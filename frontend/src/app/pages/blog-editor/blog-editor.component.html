<div class="editor-page">
    <div class="container">
        <!-- Header -->
        <header class="editor-header">
            <a routerLink="/blog" class="editor-back">
                <i class="fas fa-arrow-left"></i> Volver al blog
            </a>
            <h1>{{ isEditMode ? 'Editar Post' : 'Nuevo Post' }}</h1>
        </header>

        <!-- Loading -->
        <div class="blog-loading" *ngIf="isLoading">
            <div class="spinner"></div>
            <p>Cargando post...</p>
        </div>

        <!-- Error -->
        <div class="editor-message error-message" *ngIf="error">
            <i class="fas fa-exclamation-triangle"></i> {{ error }}
        </div>

        <!-- Success -->
        <div class="editor-message success-message" *ngIf="success">
            <i class="fas fa-check-circle"></i> {{ success }}
        </div>

        <!-- Editor Form -->
        <form (ngSubmit)="onSubmit()" class="editor-form" *ngIf="!isLoading">
            <!-- Title -->
            <div class="form-group">
                <label for="post-title">
                    <i class="fas fa-heading"></i> Título
                </label>
                <input type="text" id="post-title" [(ngModel)]="title" name="title"
                    placeholder="Un título atractivo para tu post..." required class="input-title" />
            </div>

            <!-- Excerpt -->
            <div class="form-group">
                <label for="post-excerpt">
                    <i class="fas fa-align-left"></i> Extracto (opcional)
                </label>
                <input type="text" id="post-excerpt" [(ngModel)]="excerpt" name="excerpt"
                    placeholder="Un breve resumen que aparecerá en la lista de posts..." />
            </div>

            <!-- Cover Image URL -->
            <div class="form-group">
                <label for="post-cover">
                    <i class="fas fa-image"></i> URL imagen de portada (opcional)
                </label>
                <input type="url" id="post-cover" [(ngModel)]="coverImageUrl" name="coverImageUrl"
                    placeholder="https://ejemplo.com/imagen.jpg" />
            </div>

            <!-- Content with preview toggle -->
            <div class="form-group">
                <div class="content-header">
                    <label for="post-content">
                        <i class="fas fa-pen-fancy"></i> Contenido
                    </label>
                    <button type="button" class="preview-toggle" (click)="togglePreview()">
                        <i class="fas" [class.fa-eye]="!showPreview" [class.fa-edit]="showPreview"></i>
                        {{ showPreview ? 'Editar' : 'Vista previa' }}
                    </button>
                </div>

                <textarea *ngIf="!showPreview" id="post-content" [(ngModel)]="content" name="content"
                    placeholder="Escribe tu post aquí... Puedes usar Markdown:&#13;&#10;&#13;&#10;# Título&#13;&#10;## Subtítulo&#13;&#10;**negrita**, *cursiva*, `código`&#13;&#10;&#13;&#10;```&#13;&#10;bloque de código&#13;&#10;```&#13;&#10;&#13;&#10;[enlace](url)"
                    required rows="20"></textarea>

                <div *ngIf="showPreview" class="content-preview post-content" [innerHTML]="renderPreview(content)">
                </div>
            </div>

            <!-- Publish Toggle -->
            <div class="publish-row">
                <label class="publish-toggle">
                    <input type="checkbox" [(ngModel)]="published" name="published" />
                    <span class="toggle-slider"></span>
                    <span class="toggle-label">
                        {{ published ? 'Publicar' : 'Guardar como borrador' }}
                    </span>
                </label>
                <span class="publish-hint" *ngIf="!published">
                    <i class="fas fa-eye-slash"></i> Solo tú podrás ver este post
                </span>
                <span class="publish-hint published-hint" *ngIf="published">
                    <i class="fas fa-globe"></i> Visible para todos
                </span>
            </div>

            <!-- Submit -->
            <div class="editor-actions">
                <button type="submit" class="btn btn-primary btn-full" [disabled]="isSaving">
                    <i class="fas" [class.fa-spinner]="isSaving" [class.fa-save]="!isSaving"
                        [class.fa-spin]="isSaving"></i>
                    {{ isSaving ? 'Guardando...' : (isEditMode ? 'Actualizar Post' : 'Crear Post') }}
                </button>
            </div>
        </form>
    </div>
</div>